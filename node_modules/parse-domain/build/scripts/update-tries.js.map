{"version":3,"file":"update-tries.js","sourceRoot":"","sources":["../../src/scripts/update-tries.ts"],"names":[],"mappings":";;;;;;;;;AAAA,OAAO,KAAK,IAAI,MAAM,MAAM,CAAC;AAC7B,OAAO,KAAK,GAAG,MAAM,KAAK,CAAC;AAC3B,OAAO,KAAK,EAAE,MAAM,IAAI,CAAC;AACzB,OAAO,EAAE,wBAAwB,EAAE,MAAM,oBAAoB,CAAC;AAC9D,OAAO,EAAE,iBAAiB,EAAE,MAAM,cAAc,CAAC;AAGjD,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;AAEnE,MAAM,iBAAiB,GAAG,KAG6B,EAAE,4CAHxB,EAC/B,mBAAmB,EACnB,qBAAqB,GAC8B;IACnD,MAAM,gBAAgB,GAAG,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IACxD,MAAM,iBAAiB,GAAG,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,CAAC,CAAC,CAAC;IAEnE,MAAM,OAAO,CAAC,GAAG,CACf,iBAAiB,CAAC,GAAG,CAAC,CAAO,eAAe,EAAE,EAAE;QAC9C,MAAM,eAAe,GAAG,IAAI,CAAC,OAAO,CAClC,SAAS,EACT,eAAe,EACf,UAAU,CACX,CAAC;QACF,MAAM,iBAAiB,GAAG,IAAI,CAAC,OAAO,CACpC,SAAS,EACT,eAAe,EACf,YAAY,CACb,CAAC;QACF,MAAM,kBAAkB,GAAG,IAAI,CAAC,OAAO,CACrC,SAAS,EACT,eAAe,EACf,WAAW,CACZ,CAAC;QAEF,OAAO,CAAC,IAAI,CAAC,WAAW,eAAe,KAAK,CAAC,CAAC;QAC9C,OAAO,CAAC,IAAI,CAAC,WAAW,iBAAiB,KAAK,CAAC,CAAC;QAChD,OAAO,CAAC,IAAI,CAAC,WAAW,kBAAkB,KAAK,CAAC,CAAC;QAEjD,MAAM,OAAO,CAAC,GAAG,CAAC;YAChB,EAAE,CAAC,QAAQ,CAAC,SAAS,CACnB,eAAe,EACf,kBAAkB,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,GAAG,CACzD;YACD,EAAE,CAAC,QAAQ,CAAC,SAAS,CACnB,iBAAiB,EACjB,kBAAkB,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAAC,GAAG,CAC3D;YACD,EAAE,CAAC,QAAQ,CAAC,SAAS,CACnB,kBAAkB,EAClB,IAAI,CAAC,SAAS,CAAC;gBACb,SAAS,EAAE,IAAI,IAAI,EAAE;aACtB,CAAC,CACH;SACF,CAAC,CAAC;IACL,CAAC,CAAA,CAAC,CACH,CAAC;AACJ,CAAC,CAAA,CAAC;AAEF,MAAM,CAAC,MAAM,IAAI,GAAG,CAAC,GAAS,EAAE;IAC9B,OAAO,CAAC,IAAI,CAAC,oCAAoC,iBAAiB,KAAK,CAAC,CAAC;IAEzE,MAAM,iBAAiB,CAAC,MAAM,wBAAwB,EAAE,CAAC,CAAC;AAC5D,CAAC,CAAA,CAAC,EAAE,CAAC","sourcesContent":["import * as path from \"path\";\nimport * as url from \"url\";\nimport * as fs from \"fs\";\nimport { fetchBuildSerializeTries } from \"../update-tries.js\";\nimport { PUBLIC_SUFFIX_URL } from \"../config.js\";\nimport { Await } from \"../type-util.js\";\n\nconst __dirname = path.dirname(url.fileURLToPath(import.meta.url));\n\nconst writeTriesToFiles = async ({\n  serializedIcannTrie,\n  serializedPrivateTrie,\n}: Await<ReturnType<typeof fetchBuildSerializeTries>>) => {\n  const indexOfScriptArg = process.argv.lastIndexOf(\"--\");\n  const targetDirectories = process.argv.slice(indexOfScriptArg + 1);\n\n  await Promise.all(\n    targetDirectories.map(async (targetDirectory) => {\n      const pathToIcannTrie = path.resolve(\n        __dirname,\n        targetDirectory,\n        \"icann.js\",\n      );\n      const pathToPrivateTrie = path.resolve(\n        __dirname,\n        targetDirectory,\n        \"private.js\",\n      );\n      const pathToTrieInfoFile = path.resolve(\n        __dirname,\n        targetDirectory,\n        \"info.json\",\n      );\n\n      console.warn(`Writing ${pathToIcannTrie}...`);\n      console.warn(`Writing ${pathToPrivateTrie}...`);\n      console.warn(`Writing ${pathToTrieInfoFile}...`);\n\n      await Promise.all([\n        fs.promises.writeFile(\n          pathToIcannTrie,\n          `export default ${JSON.stringify(serializedIcannTrie)};`,\n        ),\n        fs.promises.writeFile(\n          pathToPrivateTrie,\n          `export default ${JSON.stringify(serializedPrivateTrie)};`,\n        ),\n        fs.promises.writeFile(\n          pathToTrieInfoFile,\n          JSON.stringify({\n            updatedAt: new Date(),\n          }),\n        ),\n      ]);\n    }),\n  );\n};\n\nexport const done = (async () => {\n  console.warn(`Fetching public suffix list from ${PUBLIC_SUFFIX_URL}...`);\n\n  await writeTriesToFiles(await fetchBuildSerializeTries());\n})();\n"]}